<main>
  <section class="header">
    <div class="navigation">
      <h1 class="no-margin">Übersicht</h1>
    </div>

    <mat-divider></mat-divider>
  </section>

  <section *ngIf="loaded">
    <mat-tab-group (selectedIndexChange)="selectTab($event)">
      <mat-tab *ngFor="let phase of tournament.phases" [label]="phase.name">
        <mat-tab-group (selectedIndexChange)="selectGroup($event)">
          <mat-tab label="Übersicht">
            <table
              mat-table
              [dataSource]="tableData"
              class="mat-elevation-z8"
              matSort
              matSortActive="pointsAll"
              matSortDirection="desc"
              matSortDisableClear>
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Spieler</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{ disqualified: element.disqualified }"
                  (click)="openViewLogComponent(phase, element.id)">
                  {{ playerNameString(element.players) }}
                </td>
              </ng-container>

              <ng-container matColumnDef="pointsAll">
                <th mat-header-cell mat-sort-header *matHeaderCellDef>Punkte (all)</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{ disqualified: element.disqualified }"
                  (click)="openViewLogComponent(phase, element.id)">
                  {{ getPointsSum(element.points) }}
                </td>
              </ng-container>

              <ng-container [matColumnDef]="'points' + i" *ngFor="let round of counter(phase.rounds); index as i">
                <th mat-header-cell mat-sort-header *matHeaderCellDef>Punkte ({{ i + 1 }})</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{ disqualified: element.disqualified }"
                  (click)="openViewLogComponent(phase, element.id)">
                  {{ element.points.get(i) || 0 }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="columns.get(phase.acronym)"></tr>
              <tr mat-row *matRowDef="let row; columns: columns.get(phase.acronym)"></tr>
            </table>
          </mat-tab>

          <mat-tab *ngFor="let group of counter(phase.groups); index as i" [label]="'Gruppe ' + groups[i]">
            <table
              mat-table
              matSort
              [dataSource]="tableData"
              class="mat-elevation-z8"
              matSortActive="pointsAll"
              matSortDirection="desc"
              matSortDisableClear>
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Spieler</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{ disqualified: element.disqualified }"
                  (click)="openViewLogComponent(phase, element.id)">
                  {{ playerNameString(element.players) }}
                </td>
              </ng-container>

              <ng-container matColumnDef="pointsAll">
                <th mat-header-cell mat-sort-header *matHeaderCellDef>Punkte (all)</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{ disqualified: element.disqualified }"
                  (click)="openViewLogComponent(phase, element.id)">
                  {{ getPointsSum(element.points) }}
                </td>
              </ng-container>

              <ng-container [matColumnDef]="'points' + i" *ngFor="let round of counter(phase.rounds); index as i">
                <th mat-header-cell mat-sort-header *matHeaderCellDef>Punkte ({{ i + 1 }})</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{ disqualified: element.disqualified }"
                  (click)="openViewLogComponent(phase, element.id)">
                  {{ element.points.get(i) || 0 }}
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="columns.get(phase.acronym)"></tr>
              <tr mat-row *matRowDef="let row; columns: columns.get(phase.acronym)"></tr>
            </table>
          </mat-tab>
        </mat-tab-group>
      </mat-tab>
    </mat-tab-group>
  </section>
</main>

<app-spinner *ngIf="!loaded"></app-spinner>
